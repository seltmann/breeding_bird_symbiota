---
title: "Breeding Bird survey to Symbiota upload"
author: "Katja Seltmann"
date: "03 15 2021"
output: html_document
---

```{r setup, include=FALSE}
library(janitor)
library(tidyverse)
library(here)
library(lubridate)

```

### Objective: Take data from the [Santa Barbara Breeding Bird Survey](https://santabarbaraaudubon.org/santa-barbara-county-breeding-bird-study/) format in Darwin Core and upload to UCSB Natural History Collection Network Portal. Export portal to GBIF/. record_number is the unique identifier for this record.

#identifier = record_number
#occurrenceRemarks = breeding_evidence, comments, observation, nest_species_structure,nest_hgt_meters,sources
#recordedBy = observer
#associatedTaxa = nest_species_structure
#basisOFRecord = HumanObservation
#scientificName = scientific_name
#coordinateUncertaintyInMeters = gps_certainty_meters
#maximumElevationInMeters = elev_meters
#eventDate = 
#remove x, y (from ArcGIS)
#Ignore the time (remove it if possible)

```{r}
#read in data
birds <- read_csv(here("SB_BBS_csv_2020.csv"))

#clean column names and create new date_transform and selected_observer columns. Can add new selected observers to this list to include in the filtering.
birds <- birds %>%
  clean_names() %>%
  mutate(occurrenceID = record_number) %>%
  mutate(basisOFRecord = "HumanObservation") %>%
  mutate(country = "United States of America") %>%
  mutate(stateProvince = "California") %>%
  mutate(county = "Santa Barbara") %>%
  mutate(decimalLongitude = longitude) %>%
  mutate(decimalLatitude = latitude) %>%
  mutate(coordinateUncertaintyInMeters = gps_certainty_meters) %>%
  mutate(maximumElevationInMeters = elev_meters) %>%
  mutate(recordedBy = observer) %>%
  mutate(occurrenceRemarks = paste(breeding_evidence,code,common_name, comments,observation,nest_species_structure,nest_hgt_meters,sources, sep = "; "))

colnames(birds)
View(birds)

```

```{r}
#remove time from dates and format dates so Year-Month-Day
birds <- birds %>%
  mutate(eventDate = str_extract(birds$date,"^\\S+")) %>%
  mutate(eventDate = mdy(eventDate))

```

```{r}
#remove extra columns
birds = select(birds, -c(1:22))
```

```{r}
#write file for upload to Symbiota
write_tsv(birds,"breeding_bird_DwC.tsv")

```








